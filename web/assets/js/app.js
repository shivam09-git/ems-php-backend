console.log('App script loaded');
async function fetchEmployees(){ const res = await fetch('../backend/get_employees.php', {credentials:'same-origin'}); return await res.json(); }
function renderTable(tblId, employees){ const tbody = document.querySelector(tblId+' tbody'); tbody.innerHTML=''; employees.forEach(e=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${e.id}</td><td>${e.name}</td><td>${e.email}</td><td>${e.position||''}</td><td>${e.salary||0}</td><td><button class="btn ghost" onclick="editEmployee(${e.id})">Edit</button> <button class="btn" onclick="deleteEmployee(${e.id})">Delete</button></td>`; tbody.appendChild(tr); }); }
async function loadEmployees(){ const d = await fetchEmployees(); if(d.status==='ok'){ renderTable('#employeesTable', d.employees); document.getElementById('totalEmployees') && (document.getElementById('totalEmployees').textContent = d.employees.length); } }
async function addEmployeeFromForm(){ const name=document.getElementById('ename').value.trim(); const email=document.getElementById('eemail').value.trim(); const position=document.getElementById('eposition').value.trim(); const salary=document.getElementById('esalary').value.trim(); if(!name||!email){ alert('Name & email required'); return;} const fd=new FormData(); fd.append('name',name); fd.append('email',email); fd.append('position',position); fd.append('salary',salary); const res=await fetch('../backend/save_employee.php',{method:'POST',body:fd,credentials:'same-origin'}); const j=await res.json(); if(j.status==='ok'){ closeModal(); loadEmployees(); } else alert(j.error||'Error'); }
function openModal(){ document.getElementById('modalRoot').style.display='flex'; }
function closeModal(){ document.getElementById('modalRoot').style.display='none'; }
async function deleteEmployee(id){ if(!confirm('Delete this employee?')) return; const fd=new FormData(); fd.append('id',id); const res=await fetch('../backend/delete_employee.php',{method:'POST',body:fd,credentials:'same-origin'}); const j=await res.json(); if(j.status==='ok') loadEmployees(); else alert(j.error||'Error'); }
function editEmployee(id){ fetchEmployees().then(d=>{ const emp=d.employees.find(x=>x.id==id); if(!emp) return alert('Employee not found'); document.getElementById('ename').value=emp.name; document.getElementById('eemail').value=emp.email; document.getElementById('eposition').value=emp.position||''; document.getElementById('esalary').value=emp.salary||0; let hid=document.getElementById('eId'); if(!hid){ hid=document.createElement('input'); hid.type='hidden'; hid.id='eId'; document.querySelector('.modal').appendChild(hid); } hid.value=emp.id; openModal(); }); }
window.addEventListener('DOMContentLoaded', function(){ document.getElementById('openAdd') && document.getElementById('openAdd').addEventListener('click', ()=>{ document.getElementById('ename').value=''; document.getElementById('eemail').value=''; document.getElementById('eposition').value=''; document.getElementById('esalary').value=''; document.getElementById('eId') && (document.getElementById('eId').value=''); openModal(); }); document.getElementById('saveEmp') && document.getElementById('saveEmp').addEventListener('click', addEmployeeFromForm); document.getElementById('modalRoot') && (document.getElementById('modalRoot').style.display='none'); loadEmployees(); });